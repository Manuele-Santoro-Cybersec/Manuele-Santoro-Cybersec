üõ°Ô∏è Penetration Testing in a Nutshell: Practical Walkthrough
Module Status: Completed ‚úÖ | Platform: HTB Academy | Role Focus: SOC Analyst / Penetration Tester

üìå Executive Summary
This document outlines the practical execution of a penetration test against two distinct environments (a Linux target and a Windows target). The objective of this assessment was to identify vulnerabilities, gain initial access, escalate privileges, and demonstrate the potential impact of post-exploitation data gathering (pillaging) from a defender's perspective.

Understanding these attack vectors is critical for a SOC Analyst to properly identify Indicators of Compromise (IoCs) and build robust detection rules.

‚öôÔ∏è Methodology
The assessment strictly followed the eight standard phases of the Penetration Testing Execution Standard:

Pre-Engagement: Defining scope, rules of engagement (ROE), and documentation.

Information Gathering: Collecting open-source intelligence and target infrastructure details.

Vulnerability Assessment: Analyzing gathered data to identify potential attack vectors (focusing on "Low Hanging Fruits" such as misconfigurations).

Exploitation: Executing payloads to breach the system.

Post-Exploitation: Securing the foothold and gathering internal system data.

Lateral Movement: Pivoting to other systems within the network.

Proof-of-Concept: Documenting the breach definitively (e.g., capturing flags).

Post-Engagement: Cleaning up the host and delivering the final report.

üêß Target 1: Linux Internal Network Compromise
1.1 Enumeration & Information Gathering
The assessment began with a comprehensive network scan of the target IP (10.129.2.28) to identify exposed services and potential entry points.

Objective: Map open ports and identify running services and their versions.

Action: Executed a full TCP port scan using Nmap.

Bash
sudo nmap -p- -sV -sC 10.129.2.28 -T5 -Pn
Result: The scan identified three open TCP ports:

Port 21 (FTP)

Port 22 (SSH)

Port 443 (HTTPS)

1.2 Initial Exploitation & Access
Analysis of the FTP service on Port 21 revealed a critical misconfiguration: "Anonymous" login was enabled.

Objective: Gain unauthorized access to the file system via misconfigured services.

Action: The team connected to the FTP share and discovered it was mapped directly to the home directory of a user named john.

Result: While enumerating the exposed files, an SSH Private Key (id_rsa) was discovered and successfully downloaded.

Exploitation: The private key was utilized to bypass password authentication, granting the team a secure shell (SSH) session on Port 22 as the user john.

1.3 Privilege Escalation
Operating with standard user privileges, the local environment was enumerated to identify escalation vectors.

Objective: Elevate privileges from a standard user to root.

Action: Checked the user's sudo privileges to identify misconfigured administrative rights.

Bash
sudo -l
Result: The output revealed that the user john possessed overly permissive sudo rights, allowing the execution of specific system binaries as root without requiring a password.

Exploitation: By leveraging these misconfigured sudo privileges, an interactive root shell was spawned, resulting in the total compromise of the Linux host.

1.4 Post-Exploitation & Pillaging
To demonstrate the severity of a root-level compromise, a custom bash automation script (linpill.sh) was deployed.

Objective: Automate the discovery and exfiltration of sensitive system data.

Execution: Run locally as root.

Findings Extracted:

Sensitive configuration files (including /etc/shadow for offline password cracking).

Writable PATH directories, highlighting potential persistence mechanisms.

Over 15 sensitive files categorized by extension (.conf, .bak, .sh), potentially containing proprietary source code or database credentials.

ü™ü Target 2: Windows Internal Network Compromise
2.1 Enumeration & Information Gathering
Following the Linux assessment, focus shifted to the Windows target environment to identify exposed services.

Objective: Map open ports and identify the operating system and enterprise services.

Action: Executed a targeted TCP port scan using Nmap.

Bash
sudo nmap -p- -sV -sC 10.129.x.x -T5 -Pn
Result: The scan revealed several open ports typical of a Windows enterprise environment, most notably:

Port 135 (MSRPC)

Port 139 (NetBIOS)

Port 445 (SMB)

Port 5985 (WinRM - Windows Remote Management)

2.2 Initial Exploitation & Access
The team focused on the Server Message Block (SMB) service on Port 445, which frequently suffers from misconfigurations regarding anonymous access.

Objective: Identify and access publicly readable SMB shares without valid credentials.

Action: Utilized smbclient to attempt a Null Session (anonymous) login and list available shares.

Bash
smbclient -N -L //10.129.x.x
Result: The enumeration revealed a non-default share (e.g., Backups). Upon connecting to this share, the team discovered a readable configuration file.

Exploitation: Extracting the contents of the configuration file yielded plaintext credentials for a standard domain user. The team then used evil-winrm to authenticate and gain a remote PowerShell session over Port 5985.

Bash
evil-winrm -i 10.129.x.x -u <username> -p '<password>'
2.3 Privilege Escalation
Operating as a standard user within a WinRM session, local enumeration was performed to identify privilege escalation vectors.

Objective: Elevate privileges from a standard user to NT AUTHORITY\SYSTEM.

Action: Interrogated the Windows Registry to check for the AlwaysInstallElevated policy.

PowerShell
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
Result: The query confirmed that the registry key was set to 1 (Enabled). This critical misconfiguration permits any standard user to execute .msi installer packages with SYSTEM privileges.

Exploitation: A malicious MSI payload was generated and executed, successfully elevating the team's privileges to NT AUTHORITY\SYSTEM.

2.4 Post-Exploitation & Pillaging
With SYSTEM level access, a custom PowerShell pillaging script (winpill.ps1) was deployed to automate data exfiltration.

Objective: Automate the extraction of credentials, network configurations, and sensitive files.

Action: Uploaded and executed the script, bypassing local execution constraints.

PowerShell
Set-ExecutionPolicy Bypass -Scope Process -Force
.\winpill.ps1
Result: The script successfully executed with SYSTEM privileges, outputting a comprehensive CSV report to C:\Pillaging_<Hostname>_<Timestamp>. Key findings included:

Dumped contents of the Windows Credential Manager.

Identification of non-Microsoft scheduled tasks (potential avenues for persistence).

A full map of enabled Windows Firewall rules to plan outbound Command & Control (C2) communication.

Identification of hundreds of interesting files (.docx, .xlsx, .config) located across all user profiles.

üí° SOC Analyst Takeaways (Defensive Perspective)
Executing these attacks highlighted several critical detection opportunities for the Blue Team:

Log Monitoring: Alert on Event ID 4624 (Successful Logon) when correlated with anomalous WinRM or RDP connections from non-standard IP ranges.

Registry Auditing: Generate alerts for modifications or the creation of the AlwaysInstallElevated registry key.

Command Line & Process Monitoring: * Alert on the usage of sudo -l by standard users on Linux endpoints.

Alert on the execution of unexpected .msi files from user-writable directories on Windows.

Monitor for the Bypass flag usage in PowerShell execution policies (Event ID 4104).
